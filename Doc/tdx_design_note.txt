Design note: Implementing Certifier for reduced functionality TDX


The initial version of TDX (which is only available to limited customers) seems not to
meet the criteria for a fully capable Confidential Computing platform since it does not
appear to have seal/unseal functionality.  There is a workaround for certifier framework
implementations as follows:

1. We write a keystore for programs in a security domain and run it on a platform with
full Confidential Computing functionality (sev, sgx, cca, keystone) or on custom hardware
that allows secure recovery of a protection key on cold start.  The keystore is a
confidential computing platform and is certified by the certifier service as usual and
acquires an admissions certificate.  The keystore generates a sealing/unsealing key
(or other keys) for each program when it is contacted for the first time (based on
the program measurement).

2. Every time a program starts on a non-confidential computing compliant TDX platform
it does a cold_init and gets certified.  It contacts the keystore (with its admissions
certificate) over a secure channel and retrieves it sealing key (and/or other keys).

3. The program can now do a warm restart and proceed as normally either with the stored
authentication key (from the store) or freshly generated one.  Processing proceeds as normally.


This solution is inferior to ones available on other Confidential Computing platforms since
it adds latency, reduces availability (since every start depends on contacting a working
certifier service AND keystore), and increases the key management responsibilities of the
service deployed.  However, it seems like the best solution possible and preserves programming
compatibility among platforms.  Hopefully, future TDX implementations fully support Confidential
Computing capabilities.

Fortunately, this only affects deployments in the few customers Intel has sold the initial
TDX implementations.  Certifier users who use other platforms at these customers and can
obtain access to SEV platforms need not worry about this.  Certifier users
who use machine outside these few cloud provides need also not worry about it.

